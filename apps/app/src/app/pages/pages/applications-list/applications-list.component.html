<section>
  <h1>{{ 'applications.title' | translate }}</h1>

  <clr-datagrid
    (clrDgRefresh)="refreshApplications($event)"
    [clrDgLoading]="(loadingApplications$ | async) ?? false"
  >
    <clr-dg-action-bar>
      <button
        type="button"
        class="btn btn-sm btn-secondary"
        (click)="manualRefreshApplications()"
      >
        {{ 'applications.actions.refresh' | translate }}
      </button>

      <clr-dropdown class="auto-refresh">
        <button
          type="button"
          class="btn btn-sm btn-secondary"
          clrDropdownTrigger
        >
          {{ 'applications.actions.auto_refresh.button.title' | translate }}
          <span *ngIf="subjectInterval | async as value">
            &nbsp;-&nbsp;
            {{
              value > 0
                ? value / 1_000 + 's'
                : ('applications.actions.auto_refresh.button.disabled'
                  | translate)
            }}
          </span>

          <clr-icon shape="caret down"></clr-icon>
        </button>
        <clr-dropdown-menu clrPosition="bottom-left" *clrIfOpen>
          <button type="button" clrDropdownItem (click)="stopInterval()">
            {{ 'applications.actions.auto_refresh.disable' | translate }}
          </button>
          <button
            type="button"
            clrDropdownItem
            *ngFor="let item of intervals; trackBy: trackByInterval"
            (click)="changeInterval(item)"
          >
            {{ item / 1_000 }}s
          </button>
        </clr-dropdown-menu>
      </clr-dropdown>
    </clr-dg-action-bar>

    <clr-dg-column
      [clrDgField]="OrderByField.ORDER_BY_FIELD_NAME.toString()"
      [clrDgSortOrder]="defaultSortOrder(OrderByField.ORDER_BY_FIELD_NAME)"
    >
      {{ 'applications.columns.name' | translate }}
    </clr-dg-column>
    <clr-dg-column
      [clrDgField]="OrderByField.ORDER_BY_FIELD_VERSION.toString()"
      [clrDgSortOrder]="defaultSortOrder(OrderByField.ORDER_BY_FIELD_VERSION)"
    >
      {{ 'applications.columns.version' | translate }}
    </clr-dg-column>
    <clr-dg-column
      [clrDgField]="OrderByField.ORDER_BY_FIELD_NAMESPACE.toString()"
      [clrDgSortOrder]="defaultSortOrder(OrderByField.ORDER_BY_FIELD_NAMESPACE)"
    >
      {{ 'applications.columns.namespace' | translate }}
    </clr-dg-column>
    <clr-dg-column
      [clrDgField]="OrderByField.ORDER_BY_FIELD_SERVICE.toString()"
      [clrDgSortOrder]="defaultSortOrder(OrderByField.ORDER_BY_FIELD_SERVICE)"
    >
      {{ 'applications.columns.service' | translate }}
    </clr-dg-column>
    <clr-dg-column>
      {{ 'applications.columns.actions' | translate }}
    </clr-dg-column>

    <ng-container *ngIf="loadApplications$ | async as list">
      <clr-dg-row *ngFor="let application of list.application">
        <clr-dg-cell>
          {{ application.name }}
        </clr-dg-cell>
        <clr-dg-cell>
          {{ application.version }}
        </clr-dg-cell>
        <clr-dg-cell>
          {{ application.namespace }}
        </clr-dg-cell>
        <clr-dg-cell>
          <span *ngIf="application.service; else empty">
            {{ application.service }}
          </span>
        </clr-dg-cell>
        <clr-dg-cell>
          <a
            class="btn btn-sm btn-secondary"
            [routerLink]="['/', 'sessions']"
            [queryParams]="{
              applicationName: application.name,
              applicationVersion: application.version
            }"
          >
            <clr-icon shape="nodes"></clr-icon>
            {{ 'applications.actions.related_sessions' | translate }}
          </a>
        </clr-dg-cell>
        <ng-template #empty> - </ng-template>
      </clr-dg-row>
    </ng-container>
    <clr-dg-footer>
      <clr-dg-pagination
        #pagination
        [clrDgPageSize]="(queryParam$('pageSize') | async) || 10"
        [clrDgTotalItems]="(totalApplications$ | async) ?? 0"
        [clrDgPage]="((queryParam$('page') | async) || 0) + 1"
      >
        <clr-dg-page-size [clrPageSizeOptions]="[10, 20, 50, 100]">{{
          'applications.pagination.per_page' | translate
        }}</clr-dg-page-size>
        <span *ngIf="(totalApplications$ | async) ?? 0 > 1 as total">
          {{
            (total > 1
              ? 'applications.pagination.applications'
              : 'applications.pagination.application'
            ) | translate: { value: total }
          }}
        </span>
      </clr-dg-pagination>
    </clr-dg-footer>
  </clr-datagrid>
</section>
