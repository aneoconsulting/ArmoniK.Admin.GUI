<clr-datagrid
  (clrDgRefresh)="refresh.emit($event)"
  [clrDgLoading]="loading"
  [clrDgSelected]="selection"
  (clrDgSelectedChange)="selectionChange.emit($event)"
>
  <clr-dg-action-bar>
    <div class="clr-row clr-justify-content-between">
      <div>
        <button
          type="button"
          class="cancel-button btn btn-sm btn-outline-danger"
          (click)="cancelTasksChange.emit()"
          [clrLoading]="cancelButtonState"
        >
          {{ 'pages.sessions.session-detail.table.cancel' | translate }}
        </button>
        <button
          type="button"
          class="refresh-button btn btn-sm btn-outline"
          (click)="manualRefresh.emit()"
        >
          {{ 'pages.sessions.session-detail.table.refresh' | translate }}
        </button>
        <div class="btn-group">
          <app-auto-refresh-activator
            [isEnabled]="isAutoRefreshEnabled"
            (autoRefreshChange)="onAutoRefreshChange()"
          ></app-auto-refresh-activator>
          <app-timer-interval-selector
            [timer]="autoRefreshTimer"
            (timerChange)="onAutoRefreshTimerChange($event)"
          ></app-timer-interval-selector>
        </div>
      </div>
      <button
        type="button"
        class="btn-delete btn btn-sm btn-summary"
        (click)="deleteState()"
      >
        {{ 'pages.sessions.session-detail.table.delete_state' | translate }}
      </button>
    </div>
  </clr-dg-action-bar>

  <clr-dg-column
    [clrDgField]="orderByField.ORDER_BY_FIELD_TASK_ID.toString()"
    [clrFilterValue]="
      getFilterValue(orderByField.ORDER_BY_FIELD_TASK_ID.toString())
    "
    [clrDgSortOrder]="
      getSortOrder(orderByField.ORDER_BY_FIELD_TASK_ID.toString())
    "
  >
    {{ 'pages.sessions.session-detail.table.task_id' | translate }}
  </clr-dg-column>
  <clr-dg-column
    [clrDgField]="orderByField.ORDER_BY_FIELD_STARTED_AT.toString()"
    [clrDgSortOrder]="
      getSortOrder(orderByField.ORDER_BY_FIELD_STARTED_AT.toString())
    "
  >
    {{ 'pages.sessions.session-detail.table.started_at' | translate }}
    <clr-dg-filter>
      {{ 'global.filters.no-filter-available' | translate }}
    </clr-dg-filter>
  </clr-dg-column>
  <clr-dg-column
    [clrDgField]="orderByField.ORDER_BY_FIELD_ENDED_AT.toString()"
    [clrDgSortOrder]="
      getSortOrder(orderByField.ORDER_BY_FIELD_ENDED_AT.toString())
    "
  >
    {{ 'pages.sessions.session-detail.table.ended_at' | translate }}
    <clr-dg-filter>
      {{ 'global.filters.no-filter-available' | translate }}
    </clr-dg-filter>
  </clr-dg-column>
  <clr-dg-column>
    {{ 'pages.sessions.session-detail.table.duration.title' | translate }}
  </clr-dg-column>
  <clr-dg-column
    [clrDgField]="orderByField.ORDER_BY_FIELD_STATUS.toString()"
    [clrDgSortOrder]="
      getSortOrder(orderByField.ORDER_BY_FIELD_STATUS.toString())
    "
  >
    {{ 'pages.sessions.session-detail.table.status.title' | translate }}
    <!-- <clr-dg-filter [clrDgFilter]="taskStatusFilter">
      <app-task-status-filter
        [value]="getFilterValue('status')"
        #taskStatusFilter
        name="status"
      ></app-task-status-filter>
    </clr-dg-filter> -->
  </clr-dg-column>
  <clr-dg-column>
    {{ 'pages.sessions.session-detail.table.detail' | translate }}
  </clr-dg-column>
  <clr-dg-column *ngIf="isSeqUp">
    {{ 'pages.sessions.session-detail.table.error.seq' | translate }}
  </clr-dg-column>

  <!-- <clr-dg-row
    *ngFor="let task of tasks?.data ?? []"
    [clrDgItem]="task"
    [ngForTrackBy]="trackByTask"
    [clrDgSelectable]="!isCompleted(task)"
  > -->
  <clr-dg-row
    *ngFor="let task of tasks ?? []"
    [clrDgItem]="task"
    [ngForTrackBy]="trackByTask"
  >
    <clr-dg-cell>
      <a [routerLink]="['tasks', task.id]">
        <span>
          {{ task.id }}
        </span>
      </a>
    </clr-dg-cell>
    <clr-dg-cell>
      <span>
        {{
          (task?.startedAt?.toISOString()
            | date: 'yyyy-MM-dd &nbsp; HH:mm:ss.SSS') ?? '-'
        }}
      </span>
    </clr-dg-cell>
    <clr-dg-cell>
      <span>
        {{
          (task?.endedAt?.toISOString()
            | date: 'yyyy-MM-dd &nbsp; HH:mm:ss.SSS') ?? '-'
        }}
      </span>
    </clr-dg-cell>
    <clr-dg-cell>
      <span>
        {{
          task.startedAt && task.endedAt
            ? printTime(
                duration(task.startedAt.toDate(), task.endedAt.toDate())
              )
            : '-'
        }}
      </span>
    </clr-dg-cell>
    <clr-dg-cell>
      <!-- <span class="text-danger" *ngIf="isError(task)">
        {{ 'pages.sessions.session-detail.table.status.error' | translate }}
      </span>
      <span class="text-creating" *ngIf="isCreating(task)">
        {{ 'pages.sessions.session-detail.table.status.creating' | translate }}
      </span>
      <span class="text-submitted" *ngIf="isSubmitted(task)">
        {{ 'pages.sessions.session-detail.table.status.submitted' | translate }}
      </span>
      <span class="text-dispatched" *ngIf="isDispatched(task)">
        {{
          'pages.sessions.session-detail.table.status.dispatched' | translate
        }}
      </span>
      <span class="text-warn" *ngIf="isProcessing(task)">
        {{
          'pages.sessions.session-detail.table.status.processing' | translate
        }}
      </span>
      <span class="text-danger" *ngIf="isCancelling(task)">
        {{
          'pages.sessions.session-detail.table.status.cancelling' | translate
        }}
      </span>
      <span class="text-warn" *ngIf="isCancelled(task)">
        {{ 'pages.sessions.session-detail.table.status.cancelled' | translate }}
      </span>
      <span class="text-success" *ngIf="isCompleted(task)">
        {{ 'pages.sessions.session-detail.table.status.completed' | translate }}
      </span>
      <span
        *ngIf="
          !isError(task) &&
          !isCreating(task) &&
          !isSubmitted(task) &&
          !isDispatched(task) &&
          !isProcessing(task) &&
          !isCancelling(task) &&
          !isCancelled(task) &&
          !isCompleted(task)
        "
      >
        -
      </span> -->
    </clr-dg-cell>
    <clr-dg-cell>
      <!-- <button
        class="btn-detail btn btn-sm"
        [disabled]="!isError(task)"
        (click)="openModal(task)"
      >
        {{ 'pages.sessions.session-detail.table.see-more' | translate }}
      </button> -->
    </clr-dg-cell>
    <clr-dg-cell *ngIf="isSeqUp">
      <!-- <a
        *ngIf="isError(task)"
        href
        (click)="onClickSeqLink($event, task.id)"
        class="seq-link"
      >
        {{ 'pages.sessions.session-detail.table.error.seq_link' | translate }}
      </a>
      <span *ngIf="!isError(task)">-</span> -->
    </clr-dg-cell>
  </clr-dg-row>

  <clr-dg-footer>
    <clr-dg-pagination
      #pagination
      [clrDgTotalItems]="total"
      [clrDgPageSize]="pageSize"
      [clrDgPage]="currentPage"
    >
      <clr-dg-page-size [clrPageSizeOptions]="[10, 20, 50, 100]">{{
        'pages.sessions.session-detail.table.per_page' | translate
      }}</clr-dg-page-size>
      {{
        (total > 1
          ? 'pages.sessions.session-detail.table.tasks'
          : 'pages.sessions.session-detail.table.task'
        ) | translate: { value: total }
      }}
    </clr-dg-pagination>
  </clr-dg-footer>
</clr-datagrid>

<!-- <clr-modal [(clrModalOpen)]="isModalOpen" clrModalSize="xl">
  <h3 class="modal-title">
    {{
      'pages.sessions.session-detail.modal.title'
        | translate: { id: activeTask?.id }
    }}
  </h3>
  <pre class="modal-body">{{ activeTask?.output?.error }}</pre>
</clr-modal> -->
