<section>
  <ui-page-header>
    <ng-container subtitle>
      <a [routerLink]="['/admin', 'dashboard']">{{
        'navigation.applications' | translate
      }}</a>
    </ng-container>
    <h1>{{ applicationName }} - {{ applicationVersion }}</h1>
  </ui-page-header>

  <h2>{{ 'pages.sessions.title' | translate }}</h2>

  <app-alert-error [errors]="errors"></app-alert-error>

  <clr-datagrid
    (clrDgRefresh)="onRefreshSessions($event)"
    [clrDgLoading]="loadingSessions"
  >
    <clr-dg-column> {{ 'pages.sessions.table.id' | translate }} </clr-dg-column>
    <clr-dg-column clrDgField="Status">
      {{ 'pages.sessions.table.status.title' | translate }}
    </clr-dg-column>
    <clr-dg-column clrDgField="CreationDate">
      {{ 'pages.sessions.table.createdAt' | translate }}
      <clr-dg-filter [clrDgFilter]="createdAtFilter">
        <app-date-filter
          #createdAtFilter
          name="createdAt"
          property="createdAt"
        ></app-date-filter>
      </clr-dg-filter>
    </clr-dg-column>
    <clr-dg-column clrDgField="CancelationDate">
      {{ 'pages.sessions.table.canceledAt' | translate }}
      <clr-dg-filter [clrDgFilter]="cancelledAtFilter">
        <app-date-filter
          #cancelledAtFilter
          name="cancelledAt"
          property="cancelledAt"
        ></app-date-filter>
      </clr-dg-filter>
    </clr-dg-column>
    <clr-dg-column>
      {{ 'pages.sessions.table.cancel' | translate }}
    </clr-dg-column>

    <clr-dg-row
      *ngFor="let session of sessions?.data"
      [ngForTrackBy]="trackSessions"
    >
      <clr-dg-cell>
        <a [routerLink]="[session._id]">
          <span>
            {{ session._id }}
          </span>
        </a>
      </clr-dg-cell>
      <clr-dg-cell>
        <span class="text-danger" *ngIf="isCanceled(session)">
          {{ 'pages.sessions.table.status.canceled' | translate }}
        </span>
        <span
          class="text-danger"
          *ngIf="!isCanceled(session) && session.countTasksError"
        >
          {{ 'pages.sessions.table.status.error' | translate }}
        </span>
        <span
          class="text-pending"
          *ngIf="
            !isCanceled(session) &&
            !session.countTasksError &&
            !session.countTasksProcessing &&
            !session.countTasksCompleted &&
            session.countTasksPending
          "
        >
          {{ 'pages.sessions.table.status.pending' | translate }}
        </span>
        <span
          class="text-warn"
          *ngIf="
            !isCanceled(session) &&
            !session.countTasksError &&
            session.countTasksProcessing
          "
        >
          {{ 'pages.sessions.table.status.processing' | translate }}
        </span>
        <span
          class="text-success"
          *ngIf="
            !isCanceled(session) &&
            !session.countTasksError &&
            !session.countTasksProcessing &&
            !session.countTasksPending &&
            session.countTasksCompleted
          "
          cancel
        >
          {{ 'pages.sessions.table.status.completed' | translate }}
        </span>
      </clr-dg-cell>
      <clr-dg-cell>
        <span>
          {{ session.createdAt | date: 'medium' }}
        </span>
      </clr-dg-cell>
      <clr-dg-cell>
        <span *ngIf="isCanceled(session)">
          {{ session.canceledAt | date: 'medium' }}
        </span>
      </clr-dg-cell>
      <clr-dg-cell>
        <button
          type="button"
          class="btn-cancel btn btn-sm btn-icon btn-danger-outline"
          [disabled]="isCanceled(session)"
          (click)="cancelSession(session._id)"
        >
          <span class="sr-only">{{
            'pages.sessions.cancel.text' | translate
          }}</span>
          <clr-icon shape="times" size="20"></clr-icon>
        </button>
      </clr-dg-cell>
    </clr-dg-row>

    <clr-dg-footer>
      <clr-dg-pagination #pagination [clrDgTotalItems]="totalSessions">
        <clr-dg-page-size>{{
          'pages.sessions.per_page' | translate
        }}</clr-dg-page-size>
        {{
          (totalSessions > 1
            ? 'pages.sessions.sessions'
            : 'pages.sessions.session'
          ) | translate: { value: totalSessions }
        }}
      </clr-dg-pagination>
    </clr-dg-footer>
  </clr-datagrid>
</section>
