syntax = "proto3";

import "pagination.proto";
import "applications.proto";

package Armonik.api.grpc.v1;

service sessions {
  rpc GetSession(GetSessionRequest) returns (GetSessionResponse) {}

  rpc GetSessions(GetSessionsRequest) returns (GetSessionsResponse) {}

  rpc CloseSession(CloseSessionRequest) returns (CloseSessionResponse) {}

  rpc ReOpenSession(ReOpenSessionRequest) returns (ReOpenSessionResponse) {}

  rpc CountSessions(CountSessionsRequest) returns (CountSessionsResponse) {}
}

message GetSessionRequest {
  Session.id id = 1;
}

message GetSessionResponse {
  Session session = 1;
}

message GetSessionsRequest {
  // TODO: Abstratire dans un message pagination
  optional Session.id per_page = 1;
  optional Session.id page = 2;
  optional string order_by = 3;
  optional string order = 4;
  // TODO: Mettre dans un SessionFilter
  optional Session.user_id user_id = 5;
  optional Session.application_id application_id = 6;
  optional Session.status status = 7;
}

message GetSessionsResponse {
  // TODO: Renommer en pagination
  PaginationMeta meta = 1;
  SessionList data = 2;
}

message CloseSessionRequest {
  Session.id id = 1;
}

message CloseSessionResponse {
  // TODO: Faire une enum pour les status
  bool success = 1;
}

message ReOpenSessionRequest {
  Session.id id = 1;
}

message ReOpenSessionResponse {
  bool success = 1;
}

message CountSessionsRequest {
  // TODO: Sessio filter
  optional Session.user_id user_id = 1;
  optional Session.application_id application_id = 2;
  optional Session.status status = 3;
}

message CountSessionsResponse {
  Session.id count = 1;
}

// Object for the Session
message Session {
  // TODO: id est un string
  fixed64 id = 1;
  int32 user_id = 2;
  // TODO: Avoir l'application en entier pour pouvoir afficher le nom
  Application.id application_id = 3;
  string closed_at = 4;
  string created_at = 4;
  string updated_at = 5;
}

message SessionList {
  repeated Session sessions = 1;
}
